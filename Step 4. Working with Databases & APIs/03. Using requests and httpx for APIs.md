Here is a **clean, beginner-friendly, deeply explained guide** to using **`requests`** (sync) and **`httpx`** (sync + async) for working with APIs in Python.
Both are extremely important for real backend projects, FastAPI services, and integration with external APIs.

---

# üöÄ **Overview: requests vs httpx**

| Feature                              | `requests` | `httpx`               |
| ------------------------------------ | ---------- | --------------------- |
| Sync support                         | ‚úî          | ‚úî                     |
| Async support                        | ‚úñ          | ‚úî (primary advantage) |
| Modern API usage                     | ‚úî          | ‚úî‚úî‚úî                   |
| HTTP/2                               | ‚úñ          | ‚úî                     |
| Recommended for FastAPI / async apps | ‚úñ          | ‚úî                     |

**Conclusion:**

* Use **`requests`** for simple synchronous scripts.
* Use **`httpx`** for modern async APIs and FastAPI.

---

# ‚≠ê 1. Using `requests` (Synchronous)

Install:

```bash
pip install requests
```

`requests` is very simple and perfect for beginners.

---

# üü¶ **1.1 Send a GET request**

```python
import requests

response = requests.get("https://jsonplaceholder.typicode.com/posts/1")
print(response.status_code)
print(response.json())
```

`response.json()` automatically parses JSON.

---

# üü¶ **1.2 Send a POST request**

```python
import requests

payload = {"title": "New Post", "body": "Hello!", "userId": 1}

response = requests.post(
    "https://jsonplaceholder.typicode.com/posts",
    json=payload
)

print(response.json())
```

---

# üü¶ **1.3 Adding headers**

```python
headers = {"Authorization": "Bearer mytoken123"}

response = requests.get(
    "https://api.example.com/data",
    headers=headers
)
```

---

# üü¶ **1.4 Query parameters**

```python
params = {"page": 1, "limit": 20}

response = requests.get("https://api.example.com/users", params=params)
```

---

# üü¶ **1.5 Handling errors**

```python
try:
    response = requests.get("https://api.example.com/data", timeout=5)
    response.raise_for_status()
except requests.exceptions.HTTPError as e:
    print("HTTP error:", e)
except requests.exceptions.Timeout:
    print("Request timed out")
```

---

# ‚≠ê 2. Using `httpx` (Sync + Async)

Install:

```bash
pip install httpx
```

`httpx` supports:
‚úî async
‚úî sync
‚úî HTTP/2
‚úî timeouts
‚úî connection pooling
‚úî modern Python usage

Perfect for FastAPI.

---

# ‚≠ê 2.1 Synchronous httpx

```python
import httpx

response = httpx.get("https://jsonplaceholder.typicode.com/posts/1")
print(response.json())
```

Exactly like `requests`.

---

# ‚≠ê 3. httpx Asynchronous (The REAL advantage)

Async client allows multiple API requests to run concurrently.

---

# üü© **3.1 Basic async httpx request**

```python
import httpx
import asyncio

async def main():
    async with httpx.AsyncClient() as client:
        r = await client.get("https://jsonplaceholder.typicode.com/posts/1")
        print(r.json())

asyncio.run(main())
```

---

# üü© **3.2 POST request**

```python
async def send_data():
    async with httpx.AsyncClient() as client:
        payload = {"name": "Nitin"}
        r = await client.post("https://api.example.com/users", json=payload)
        print(r.json())
```

---

# üü© **3.3 Adding headers**

```python
async def fetch():
    async with httpx.AsyncClient() as client:
        r = await client.get(
            "https://api.example.com/data",
            headers={"Authorization": "Bearer token123"}
        )
```

---

# ‚≠ê 4. Running multiple requests concurrently (asyncio + httpx)

This is where `httpx` becomes extremely powerful.

---

## üü© **4.1 Example with concurrency**

```python
import asyncio
import httpx

async def fetch(client, url):
    r = await client.get(url)
    return r.json()

async def main():
    urls = [
        "https://jsonplaceholder.typicode.com/posts/1",
        "https://jsonplaceholder.typicode.com/posts/2",
        "https://jsonplaceholder.typicode.com/posts/3",
    ]

    async with httpx.AsyncClient() as client:
        tasks = [fetch(client, url) for url in urls]
        results = await asyncio.gather(*tasks)

    print(results)

asyncio.run(main())
```

‚è± Total time = same as 1 request
Runs **all requests in parallel**.

---

# ‚≠ê 5. Timeout and retry logic

### Timeout:

```python
async def fetch():
    async with httpx.AsyncClient(timeout=5) as client:
        await client.get("https://api.example.com/data")
```

---

### Retry (manually):

```python
async def fetch_with_retry(url, retries=3):
    async with httpx.AsyncClient() as client:
        for attempt in range(retries):
            try:
                return await client.get(url)
            except httpx.RequestError:
                if attempt == retries - 1:
                    raise
                await asyncio.sleep(1)
```

---

# ‚≠ê 6. Authenticate using API keys, JWT, Basic auth

### Bearer Token:

```python
async with httpx.AsyncClient(
    headers={"Authorization": "Bearer <token>"}
) as client:
    ...
```

---

### Basic Auth:

```python
async with httpx.AsyncClient(auth=("username", "password")) as client:
    ...
```

---

# ‚≠ê 7. Using httpx inside FastAPI (recommended)

```python
@app.get("/external")
async def external():
    async with httpx.AsyncClient() as client:
        r = await client.get("https://api.example.com/data")
        return r.json()
```

---

# ‚≠ê 8. Uploading files

### requests:

```python
files = {"file": open("test.jpg", "rb")}
requests.post("https://api.example.com/upload", files=files)
```

### httpx:

```python
async with httpx.AsyncClient() as client:
    files = {"file": ("test.jpg", open("test.jpg", "rb"), "image/jpeg")}
    await client.post("https://api.example.com/upload", files=files)
```

---

# ‚≠ê 9. Summary Table

| Task                    | requests | httpx sync | httpx async |
| ----------------------- | -------- | ---------- | ----------- |
| GET/POST                | ‚úî        | ‚úî          | ‚úî           |
| Async requests          | ‚úñ        | ‚úñ          | ‚úî           |
| High performance        | ‚úñ        | ‚úî          | ‚úî‚úî‚úî         |
| Parallel API calls      | ‚úñ        | ‚úñ          | ‚úî           |
| HTTP/2                  | ‚úñ        | ‚úî          | ‚úî           |
| Recommended for FastAPI | ‚úñ        | ‚úî          | ‚úî‚úî‚úî         |

---
