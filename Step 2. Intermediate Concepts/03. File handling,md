Let’s go deep into **File Handling in Python**, focusing on **Text Files**, **JSON Files**, and **CSV Files** — three formats you will use frequently when working with FastAPI, ETL scripts, database imports/exports, or general backend tasks.

We will cover:

* Reading files
* Writing files
* Appending
* Safely handling files
* JSON operations
* CSV parsing & writing
* Best practices

Everything is explained clearly with examples.

---

# ✅ **1. Text File Handling**

Python handles text files using the built-in `open()` function.

## **1.1 `open()` Basics**

```python
file = open("example.txt", mode)
```

Common modes:

| Mode   | Meaning                   |
| ------ | ------------------------- |
| `"r"`  | Read (default)            |
| `"w"`  | Write (overwrite)         |
| `"a"`  | Append                    |
| `"r+"` | Read + Write              |
| `"w+"` | Write + Read (overwrites) |
| `"a+"` | Append + Read             |

---

# **1.2 Reading Text Files**

### **Method 1: `read()`**

Reads the *entire file*.

```python
with open("notes.txt", "r") as f:
    content = f.read()
    print(content)
```

### **Method 2: `readline()`**

Reads *one line* at a time.

```python
with open("notes.txt", "r") as f:
    line = f.readline()
    print(line)
```

### **Method 3: `readlines()`**

Reads all lines into a list.

```python
with open("notes.txt", "r") as f:
    lines = f.readlines()
    print(lines)
```

### **Method 4: Loop Through File**

Most memory-efficient.

```python
with open("notes.txt", "r") as f:
    for line in f:
        print(line.strip())
```

---

# **1.3 Writing Text Files**

`"w"` overwrites the file.

```python
with open("output.txt", "w") as f:
    f.write("Hello World!\n")
    f.write("This is Python file handling.")
```

---

# **1.4 Appending to Text Files**

`"a"` keeps existing content.

```python
with open("output.txt", "a") as f:
    f.write("\nNew line added.")
```

---

# **1.5 Best Practices**

* Always use `with open()` → automatically closes file
* Use `.strip()` to remove newline characters
* Use `"utf-8"` encoding for safety
* Use exceptions for safe file operations

Example with safe error handling:

```python
try:
    with open("config.txt", "r", encoding="utf-8") as f:
        data = f.read()
except FileNotFoundError:
    print("File not found!")
```

---

# ⭐ **2. JSON File Handling**

JSON is a widely-used format for APIs, config files, logs, and structured data.

Python uses the built-in `json` module.

---

# **2.1 Reading JSON**

```python
import json

with open("data.json", "r") as f:
    data = json.load(f)

print(data)
```

If the content is:

```json
{"name": "Nitin", "skills": ["Python", "FastAPI"]}
```

Output:

```python
{'name': 'Nitin', 'skills': ['Python', 'FastAPI']}
```

---

# **2.2 Writing JSON**

```python
data = {"name": "Nitin", "age": 30}

with open("output.json", "w") as f:
    json.dump(data, f, indent=4)
```

`indent=4` → pretty formatting.

---

# **2.3 Parsing JSON String (NOT File)**

```python
json_str = '{"id": 101, "status": "active"}'
data = json.loads(json_str)
```

---

# **2.4 Converting Python to JSON String**

```python
data = {"x": 1, "y": 2}
json_str = json.dumps(data)
```

---

# **2.5 Handling Non-Serializable Objects**

JSON cannot serialize Python-specific objects unless formatted.

Use `default=str`:

```python
json.dumps({"time": datetime.now()}, default=str)
```

---

# ⭐ **3. CSV File Handling**

CSV (Comma-Separated Values) is common for spreadsheets, exports, databases.

Python uses the built-in `csv` module.

---

# **3.1 Reading CSV Files**

### **Method 1: Basic Reader**

```python
import csv

with open("users.csv", "r") as f:
    reader = csv.reader(f)
    for row in reader:
        print(row)
```

---

### **Method 2: Dictionary-Based Reader**

Treats each row as a **dict** using the first row as keys.

```python
with open("users.csv", "r") as f:
    reader = csv.DictReader(f)
    for row in reader:
        print(row)
```

Input:

```
id,name,email
1,Nitin,nitin@example.com
```

Output:

```python
{'id': '1', 'name': 'Nitin', 'email': 'nitin@example.com'}
```

---

# **3.2 Writing CSV Files**

### **Method 1: Basic Writer**

```python
import csv

rows = [
    ["id", "name"],
    [1, "Nitin"],
    [2, "Arnav"]
]

with open("output.csv", "w", newline="") as f:
    writer = csv.writer(f)
    writer.writerows(rows)
```

---

### **Method 2: Writing Dict Rows**

```python
rows = [
    {"id": 1, "name": "Nitin"},
    {"id": 2, "name": "Arnav"}
]

with open("output.csv", "w", newline="") as f:
    fieldnames = ["id", "name"]
    writer = csv.DictWriter(f, fieldnames=fieldnames)

    writer.writeheader()
    writer.writerows(rows)
```

---

# ⭐ **4. Working with File Paths**

Use `pathlib` (recommended) instead of string paths.

```python
from pathlib import Path

path = Path("data/users.txt")

if path.exists():
    print(path.read_text())
```

---

# ⭐ **5. File Handling with Exception Handling**

```python
try:
    with open("data.txt", "r") as f:
        print(f.read())
except FileNotFoundError:
    print("File not found!")
except PermissionError:
    print("You don’t have permission!")
```

---

# ⭐ **6. Encoding & Unicode Safety**

```python
with open("file.txt", "r", encoding="utf-8") as f:
    text = f.read()
```

This prevents encoding errors, especially with non-English characters.

---

# ⭐ **7. Real-World Examples**

## **7.1 Logging API Requests to a File**

```python
import json

def log_request(request_data: dict):
    with open("logs.json", "a") as f:
        f.write(json.dumps(request_data) + "\n")
```

---

## **7.2 Importing CSV Data into a Database**

```python
import csv

with open("products.csv") as f:
    reader = csv.DictReader(f)
    for row in reader:
        print("Inserting:", row["name"])
```

---

## **7.3 Saving Data from an API as JSON**

```python
import json
import requests

res = requests.get("https://api.example.com/users")
data = res.json()

with open("users.json", "w") as f:
    json.dump(data, f, indent=2)
```

---

# ⭐ **8. Summary Table**

| Format | Read                   | Write          | Notes              |
| ------ | ---------------------- | -------------- | ------------------ |
| Text   | `read()`, `readline()` | `"w"`, `"a"`   | Simple string data |
| JSON   | `json.load()`          | `json.dump()`  | Structured data    |
| CSV    | `csv.reader()`         | `csv.writer()` | Table-like data    |

---
